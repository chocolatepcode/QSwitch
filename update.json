{
  "manifest.json": "{\n  \"manifest_version\": 3,\n  \"name\": \"YouTube Quality Switcher\",\n  \"version\": \"1.0\",\n  \"description\": \"Quickly change YouTube video quality with Q, W, E, R keys.\",\n  \n  \"content_scripts\": [\n    {\n      \"matches\": [\"https://www.youtube.com/watch?v=*\"],\n      \"js\": [\"scripts/content.js\"],\n      \"run_at\": \"document_idle\"\n    }\n  ],\n  \n  \"permissions\": []\n}\n",
  "scripts/content.js": "(function() {\n    'use strict';\n\n    // ======================================================================\n    // === CONFIGURATION START ==============================================\n    // ======================================================================\n\n    // 1. QUALITY MAP: Key -> Target Quality Text (MUST match YouTube's menu exactly!)\n    const qualityMap = {\n        'q': '144p',\n        'w': '360p',\n        'e': '720p',\n        'r': '1080p' \n    };\n\n    // CHANGE THIS IF YOUR YOUTUBE IS NOT ENGLISH\n    const QUALITY_TEXT_FOR_LOCALE = 'Quality'; \n\n    // ======================================================================\n    // === CONFIGURATION END ================================================\n    // ======================================================================\n\n\n    /__\n     * A helper function to safely wait for an element to appear in the DOM.\n     * @param {string} selector - The CSS selector for the element.\n     * @param {number} timeout - Maximum time (ms) to wait.\n     * @returns {Promise<Element|null>} - Resolves with the element or null if timed out.\n     */\n    function waitForElement(selector, timeout = 5000) {\n        return new Promise(resolve => {\n            const startTime = Date.now();\n\n            const check = () => {\n                const element = document.querySelector(selector);\n                if (element) {\n                    resolve(element);\n                } else if (Date.now() - startTime < timeout) {\n                    requestAnimationFrame(check);\n                } else {\n                    resolve(null);\n                }\n            };\n            requestAnimationFrame(check);\n        });\n    }\n\n    /__\n     * Attempts to click a button and navigate the YouTube quality menu.\n     * @param {string} targetQualityText - The text of the desired quality (e.g., '720p').\n     */\n    async function setVideoQuality(targetQualityText) {\n        console.log(`[QSwitch] Attempting to set quality to: ${targetQualityText}`);\n\n        // 1. Locate and click the Settings button (the gear icon)\n        const settingsButton = await waitForElement('.ytp-settings-button');\n        if (!settingsButton) {\n            console.error('[QSwitch] Settings button not found.');\n            return;\n        }\n        settingsButton.click();\n        console.log('[QSwitch] Clicked Settings button.');\n\n        // 2. Locate the 'Quality' option by text\n        const allMenuItems = await waitForElement('.ytp-panel-menu .ytp-menuitem');\n\n        let qualityMenuItem = null;\n        document.querySelectorAll('.ytp-panel-menu .ytp-menuitem').forEach(item => {\n            if (item.textContent.includes(QUALITY_TEXT_FOR_LOCALE)) {\n                qualityMenuItem = item;\n            }\n        });\n\n        if (!qualityMenuItem) {\n            console.error(`[QSwitch] Quality menu item containing \"${QUALITY_TEXT_FOR_LOCALE}\" not found.`);\n            settingsButton.click(); // Close the menu\n            return;\n        }\n        qualityMenuItem.click();\n        console.log('[QSwitch] Clicked Quality menu item.');\n\n        // 3. Find the target quality by text\n        const targetOption = await waitForElement('.ytp-quality-menu .ytp-menuitem', 2000);\n\n        let targetQualityElement = null;\n        document.querySelectorAll('.ytp-quality-menu .ytp-menuitem').forEach(option => {\n            if (option.textContent.includes(targetQualityText)) {\n                targetQualityElement = option;\n            }\n        });\n\n        if (targetQualityElement) {\n            // 4. Click the target quality\n            targetQualityElement.click();\n            console.log(`[QSwitch] Successfully switched quality to ${targetQualityText}`);\n        } else {\n            console.error(`[QSwitch] Target quality option '${targetQualityText}' not found in the list.`);\n            // Click the back button/first item to close the menu\n            document.querySelector('.ytp-quality-menu .ytp-menuitem').click();\n        }\n    }\n\n\n    // Add the global keyboard listener\n    document.addEventListener('keydown', (event) => {\n        // Guardrails: Don't run if typing or using modifiers\n        if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' || event.target.isContentEditable || event.target.getAttribute('role') === 'textbox') {\n            return;\n        }\n        if (event.ctrlKey || event.altKey || event.shiftKey || event.metaKey) {\n            return;\n        }\n\n        const key = event.key.toLowerCase();\n\n        if (qualityMap[key]) {\n            event.preventDefault(); \n            setVideoQuality(qualityMap[key]);\n        }\n    });\n\n})();\n"
}